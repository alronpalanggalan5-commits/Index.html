<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANALOG_HORROR_FIX</title>
    <style>
        body { background: #050505; color: #800; text-align: center; font-family: monospace; padding: 20px; }
        .box { border: 1px solid #333; padding: 20px; background: #000; }
        canvas { border: 2px solid #444; max-width: 100%; display: none; margin-top: 15px; }
        button { 
            background: #200; color: #f00; border: 1px solid #f00; 
            padding: 15px; cursor: pointer; font-weight: bold; margin-top: 10px;
        }
        #downloadLink { display: none; margin-top: 15px; color: white; text-decoration: underline; }
    </style>
</head>
<body>

    <div class="box">
        <h2>CORRUPT_IMAGE_v6</h2>
        <input type="file" id="picker" accept="image/*">
        <br>
        <canvas id="canvas"></canvas>
        <br>
        <button id="saveBtn" style="display:none;">APPLY_CORRUPTION & SAVE</button>
        <br>
        <a id="downloadLink">DOWNLOAD_CORRUPTED_FILE.PNG</a>
    </div>

    <script>
        const picker = document.getElementById('picker');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const saveBtn = document.getElementById('saveBtn');
        const downloadLink = document.getElementById('downloadLink');
        let img = new Image();

        picker.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            img.src = URL.createObjectURL(file);
            img.onload = () => {
                canvas.width = 600;
                canvas.height = 600;
                canvas.style.display = 'inline-block';
                saveBtn.style.display = 'inline-block';
                renderHorror();
            };
        };

        function renderHorror() {
            // 1. Black base
            ctx.filter = "none";
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Heavy Grayscale/Contrast
            ctx.filter = "contrast(250%) brightness(40%) grayscale(100%)";
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            // 3. Add random "Analog" Glitches
            ctx.filter = "none";
            for(let i=0; i<10; i++) {
                let y = Math.random() * canvas.height;
                let h = Math.random() * 20;
                let xShift = (Math.random() - 0.5) * 40;
                ctx.drawImage(canvas, 0, y, canvas.width, h, xShift, y, canvas.width, h);
            }

            // 4. Scanlines
            ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
            for (let i = 0; i < canvas.height; i += 4) {
                ctx.fillRect(0, i, canvas.width, 2);
            }

            // 5. Static Noise
            for (let i = 0; i < 1000; i++) {
                ctx.fillStyle = "rgba(255,255,255,0.05)";
                ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, 1, 1);
            }
        }

        saveBtn.onclick = () => {
            renderHorror(); // One last glitch pass
            const dataUrl = canvas.toDataURL("image/png");
            downloadLink.href = dataUrl;
            downloadLink.download = "corrupted_entity.png";
            downloadLink.style.display = "block";
            downloadLink.innerText = "[ CLICK_TO_DOWNLOAD_FINAL_IMAGE ]";
        };
    </script>
</body>
</html>
