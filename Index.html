<!DOCTYPE html>
<html>
<head>
    <style>
        body { background: #000; color: #0f0; text-align: center; font-family: monospace; }
        canvas { border: 2px solid #333; max-width: 100%; margin-top: 10px; display: none; }
        #controls { margin: 20px; }
        button { background: #222; color: #0f0; border: 1px solid #0f0; padding: 10px; cursor: pointer; }
        #status { margin-top: 10px; color: white; }
    </style>
</head>
<body>

    <h2>ANALOG_RECORDER_V1.0</h2>
    <input type="file" id="picker" accept="image/*">
    <div id="controls">
        <button id="recordBtn" style="display:none;">GENERATE GIF (5 SECS)</button>
    </div>
    <div id="status"></div>
    
    <canvas id="canvas"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

    <script>
        const picker = document.getElementById('picker');
        const recordBtn = document.getElementById('recordBtn');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const status = document.getElementById('status');
        
        let img = new Image();

        picker.onchange = (e) => {
            const file = e.target.files[0];
            img.src = URL.createObjectURL(file);
            img.onload = () => {
                canvas.width = 400; // Standard square horror size
                canvas.height = 400;
                canvas.style.display = 'inline-block';
                recordBtn.style.display = 'inline-block';
                drawFrame(); // Show preview
            };
        };

        function drawFrame() {
            // Darken background
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Add random jitter (The Shake)
            let jitterX = Math.random() * 4 - 2;
            let jitterY = Math.random() * 4 - 2;

            // Apply "Scary" Filters
            ctx.filter = "contrast(1.5) brightness(0.7) grayscale(1)";
            ctx.drawImage(img, jitterX, jitterY, canvas.width, canvas.height);
            
            // Draw Scanlines
            ctx.filter = "none";
            ctx.fillStyle = "rgba(0, 0, 0, 0.2)";
            for (let i = 0; i < canvas.height; i += 4) {
                ctx.fillRect(0, i, canvas.width, 2);
            }

            // Timestamp
            ctx.fillStyle = "white";
            ctx.font = "14px Courier New";
            ctx.fillText("REC 1984.10.31", 20, 380);
        }

        recordBtn.onclick = () => {
            status.innerText = "Encoding... Please wait.";
            const gif = new GIF({ workers: 2, quality: 10 });

            // Capture 20 frames for a smooth glitch loop
            for (let i = 0; i < 20; i++) {
                drawFrame();
                gif.addFrame(ctx, {copy: true, delay: 100});
            }

            gif.on('finished', function(blob) {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = "horror_glitch.gif";
                link.innerText = "CLICK HERE TO DOWNLOAD GIF";
                status.innerHTML = "";
                status.appendChild(link);
            });

            gif.render();
        };
    </script>
</body>
</html>
